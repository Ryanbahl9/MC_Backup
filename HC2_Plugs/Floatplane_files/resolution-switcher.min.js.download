"use strict";!function(){var e;e=void 0===window.videojs&&"function"==typeof require?require("video.js"):window.videojs,function(e,s){var t,n={ui:!0},r=s.getComponent("MenuItem"),l=s.extend(r,{constructor:function(e,t){t.selectable=!0,r.call(this,e,t),this.src=t.src,e.on("resolutionchange",s.bind(this,this.update))}});l.prototype.handleClick=function(e){r.prototype.handleClick.call(this,e),this.player_.currentResolution(this.options_.label)},l.prototype.update=function(){var e=this.player_.currentResolution();this.selected(this.options_.label===e.label)},r.registerComponent("ResolutionMenuItem",l);var o=s.getComponent("MenuButton"),c=s.extend(o,{constructor:function(e,t){if(this.label=document.createElement("span"),t.label="Quality",o.call(this,e,t),this.el().setAttribute("aria-label","Quality"),this.controlText("Quality"),t.dynamicLabel)s.addClass(this.label,"vjs-resolution-button-label"),this.el().appendChild(this.label);else{var r=document.createElement("span");s.addClass(r,"vjs-menu-icon"),this.el().appendChild(r)}e.on("updateSources",s.bind(this,this.update))}});c.prototype.createItems=function(){var e=[],t=this.sources&&this.sources.label||{};for(var r in t)t.hasOwnProperty(r)&&e.push(new l(this.player_,{label:r,src:t[r],selected:r===(!!this.currentSelection&&this.currentSelection.label)}));return e},c.prototype.update=function(){return this.sources=this.player_.getGroupedSrc(),this.currentSelection=this.player_.currentResolution(),this.label.innerHTML=this.currentSelection?this.currentSelection.label:"",o.prototype.update.call(this)},c.prototype.buildCSSClass=function(){return o.prototype.buildCSSClass.call(this)+" vjs-resolution-button"},o.registerComponent("ResolutionMenuButton",c),t=function(e){var o=s.mergeOptions(n,e),i=this;function u(e,t){return e.res&&t.res?+t.res-+e.res:0}function a(e){var t={label:{},res:{},type:{}};return e.map(function(e){r(t,"label",e),r(t,"res",e),r(t,"type",e),l(t,"label",e),l(t,"res",e),l(t,"type",e)}),t}function r(e,t,r){null==e[t][r[t]]&&(e[t][r[t]]=[])}function l(e,t,r){e[t][r[t]].push(r)}i.updateSrc=function(e){if(!e)return i.src();e=e.filter(function(e){try{return""!==i.canPlayType(e.type)}catch(e){return!0}}),this.currentSources=e.sort(u),this.groupedSrc=a(this.currentSources);var t,r,l,s,n=(t=this.groupedSrc,r=this.currentSources,l=o.default,s="","high"===l?(l=r[0].res,s=r[0].label):"low"!==l&&null!=l&&t.res[l]?t.res[l]&&(s=t.res[l][0].label):(l=r[r.length-1].res,s=r[r.length-1].label),{res:l,label:s,sources:t.res[l]});return this.currentResolutionState={label:n.label,sources:n.sources},i.trigger("updateSources"),i.setSourcesSanitized(n.sources,n.label),i.trigger("resolutionchange"),i},i.currentResolution=function(e,t){if(null==e)return this.currentResolutionState;if(this.groupedSrc&&this.groupedSrc.label&&this.groupedSrc.label[e]){var r=this.groupedSrc.label[e],l=i.currentTime(),s=i.paused();!s&&this.player_.options_.bigPlayButton&&this.player_.bigPlayButton.hide();var n="loadeddata";return"Youtube"!==this.player_.techName_&&"none"===this.player_.preload()&&"Flash"!==this.player_.techName_&&(n="timeupdate"),i.setSourcesSanitized(r,e,t||o.customSourcePicker).one(n,function(){i.currentTime(l),i.handleTechSeeked_(),s||i.play().handleTechSeeked_(),i.trigger("resolutionchange")}),i}},i.getGroupedSrc=function(){return this.groupedSrc},i.setSourcesSanitized=function(e,t,r){return this.currentResolutionState={label:t,sources:e},"function"==typeof r?r(i,e,t):(i.src(e.map(function(e){return{src:e.src,type:e.type,res:e.res,drm:e.drm}})),i)},i.ready(function(){if(o.ui){var e=new c(i,o);i.controlBar.resolutionSwitcher=i.controlBar.el_.insertBefore(e.el_,i.controlBar.getChild("fullscreenToggle").el_),i.controlBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)}}var l,s,n;1<i.options_.sources.length&&i.updateSrc(i.options_.sources),"Youtube"===i.techName_&&(l=i,s={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"auto"}},n=function(e,t,r){return l.tech_.ytPlayer.setPlaybackQuality(t[0]._yt),l.trigger("updateSources"),l},o.customSourcePicker=n,l.tech_.ytPlayer.setPlaybackQuality("auto"),l.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",function(e){for(var t in s)if(t.yt===e.data)return void l.currentResolution(t.label,n)}),l.one("play",function(){var e=l.tech_.ytPlayer.getAvailableQualityLevels(),t=[];e.map(function(e){t.push({src:l.src().src,type:l.src().type,label:s[e].label,res:s[e].res,_yt:s[e].yt})}),l.groupedSrc=a(t);var r={label:"auto",res:0,sources:l.groupedSrc.label.auto};this.currentResolutionState={label:r.label,sources:r.sources},l.trigger("updateSources"),l.setSourcesSanitized(r.sources,r.label,n)}))})},s.plugin("videoJsResolutionSwitcher",t)}(window,e)}();