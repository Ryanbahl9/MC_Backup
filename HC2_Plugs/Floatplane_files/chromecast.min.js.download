"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).video||(t.video={})).jsChromecast=e()}}(function(){return function a(r,s,c){function u(t,e){if(!s[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(d)return d(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[t]={exports:{}};r[t][0].call(n.exports,function(e){return u(r[t][1][e]||e)},n,n.exports,a,r,s,c)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,d,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var t,i=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),n=function(e,t,i){for(var o=!0;o;){var n=e,a=t,r=i;o=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(n);if(null===u)return;e=u,t=a,i=r,o=!0,s=u=void 0}},o="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,g=(t=o)&&t.__esModule?t:{default:t},a=g.default.getComponent("Component"),r=g.default.getComponent("ControlBar"),s=g.default.getComponent("Button"),c=!1,u=function(e){function o(e,t){var i=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o),n(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,e,t),this.hide(),this.initializeApi(),t.appId=e.options_.chromecast.appId,(e.chromecast=this).on(e,"loadstart",function(){i.casting&&i.apiInitialized&&i.onSessionSuccess(i.apiSession)}),this.on(e,"dispose",function(){i.casting&&i.apiSession&&i.apiSession.stop(null,null)})}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,s),i(o,[{key:"initializeApi",value:function(){var e=void 0,t=void 0,i=void 0;if(g.default.browser.IS_CHROME&&!g.default.browser.IS_EDGE&&"undefined"!=typeof chrome)return chrome.cast&&chrome.cast.isAvailable?(g.default.log("Cast APIs are available"),t=this.options_.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=new chrome.cast.SessionRequest(t),e=new chrome.cast.ApiConfig(i,this.sessionJoinedListener.bind(this),this.receiverListener.bind(this)),chrome.cast.initialize(e,this.onInitSuccess.bind(this),this.castError.bind(this))):(g.default.log("Cast APIs not available"),this.tryingReconnect<10&&(this.setTimeout(this.initializeApi,1e3),++this.tryingReconnect),void g.default.log("Cast APIs not available. Max reconnect attempt"))}},{key:"castError",value:function(e){var t={code:e.code,message:e.description};switch(e.code){case chrome.cast.ErrorCode.API_NOT_INITIALIZED:case chrome.cast.ErrorCode.EXTENSION_MISSING:case chrome.cast.ErrorCode.EXTENSION_NOT_COMPATIBLE:case chrome.cast.ErrorCode.INVALID_PARAMETER:case chrome.cast.ErrorCode.LOAD_MEDIA_FAILED:case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:case chrome.cast.ErrorCode.SESSION_ERROR:case chrome.cast.ErrorCode.CHANNEL_ERROR:case chrome.cast.ErrorCode.TIMEOUT:this.addClass("error");break;case chrome.cast.ErrorCode.CANCEL:break;default:this.player_.error(t)}return g.default.log("Cast Error: "+JSON.stringify(e))}},{key:"onInitSuccess",value:function(){return c?this.show():this.hide(),this.apiInitialized=!0}},{key:"sessionJoinedListener",value:function(e){return e.media.length&&(this.apiSession=e,this.onMediaDiscovered(e.media[0])),console.log("Session joined")}},{key:"receiverListener",value:function(e){return"available"===e?(c=!0,this.show()):(c=!1,this.hide())}},{key:"doLaunch",value:function(){return g.default.log("Cast video: "+this.player_.cache_.src),this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError.bind(this)):g.default.log("Session not initialized")}},{key:"onSessionSuccess",value:function(e){var t=void 0,i=void 0,o=void 0,n=void 0,a=void 0,r=void 0;this.apiSession=e;var s=this.player_.cache_.src,c=this.player_.currentType();if(g.default.log("Session initialized: "+e.sessionId+" source : "+s+" type : "+c),(n=new chrome.cast.media.MediaInfo(s,c)).metadata=new chrome.cast.media.GenericMediaMetadata,this.options_.playerOptions.chromecast.metadata)for(i in a=this.options_.playerOptions.chromecast.metadata)r=a[i],n.metadata[i]=r;var u=this.player().poster();u&&(t=new chrome.cast.Image(u),n.metadata.images=[t]);var d=this.player().textTracks(),l=this.player().remoteTextTrackEls(),p=[],h=0,f=void 0,y=void 0,v=0,m=void 0;if(d){for(h=0;h<d.length;h++)y=d.tracks_[h],f=l&&l.trackElements_&&l.trackElements_[h],v++,(m=new chrome.cast.media.Track(v,chrome.cast.media.TrackType.TEXT)).trackContentId=f?f.src:"caption_"+y.language,m.subtype=chrome.cast.media.TextTrackType.CAPTIONS,m.name=y.label,m.language=y.language,m.customData=null,p.push(m);n.textTrackStyle=new chrome.cast.media.TextTrackStyle,n.textTrackStyle.foregroundColor="#FFFFFF",n.textTrackStyle.backgroundColor="#00000060",n.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,n.textTrackStyle.windowType=chrome.cast.media.TextTrackWindowType.ROUNDED_CORNERS}try{if(d=this.player().audioTracks())for(h=0;h<d.length;h++)y=d.tracks_[h],v++,(m=new chrome.cast.media.Track(v,chrome.cast.media.TrackType.AUDIO)).subtype=null,m.name=y.label,m.language=y.language,m.customData=null,p.push(m)}catch(e){g.default.log("get player audioTracks fail"+e)}p.length&&(n.tracks=p),(o=new chrome.cast.media.LoadRequest(n)).autoplay=!0,o.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(o,this.onMediaDiscovered.bind(this),this.castError.bind(this)),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))}},{key:"onMediaDiscovered",value:function(e){this.player_.loadTech_("Chromecast",{type:"cast",apiMedia:e,apiSession:this.apiSession}),this.casting=!0,this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0),this.addClass("connected"),this.removeClass("error")}},{key:"onSessionUpdate",value:function(e){if(this.player_.apiMedia)return e?void 0:this.onStopAppSuccess()}},{key:"stopCasting",value:function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.castError.bind(this))}},{key:"onStopAppSuccess",value:function(){this.casting=!1;var e=this.player_.currentTime();return this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.player_.paused()||this.player_.one("seeked",function(){return this.player_.play()}),this.player_.currentTime(e),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.apiSession=null}},{key:"buildCSSClass",value:function(){return"vjs-chromecast-button "+n(Object.getPrototypeOf(o.prototype),"buildCSSClass",this).call(this)}},{key:"handleClick",value:function(){return n(Object.getPrototypeOf(o.prototype),"handleClick",this).call(this),this.casting?this.stopCasting():this.doLaunch()}}]),o}();u.prototype.tryingReconnect=0,u.prototype.inactivityTimeout=2e3,u.prototype.controlText_="Chromecast",r.prototype.options_.children.splice(r.prototype.options_.children.length-1,0,"chromeCastButton"),a.registerComponent("ChromeCastButton",u),l.default=u,d.exports=l.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,r,s){(function(e){Object.defineProperty(s,"__esModule",{value:!0});var t,i=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),d=function(e,t,i){for(var o=!0;o;){var n=e,a=t,r=i;o=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(n);if(null===u)return;e=u,t=a,i=r,o=!0,s=u=void 0}},o="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,l=(t=o)&&t.__esModule?t:{default:t},n=(l.default.getComponent("Component"),l.default.getComponent("Tech")),a=function(e){function u(e,t){var i=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,u),d(Object.getPrototypeOf(u.prototype),"constructor",this).call(this,e,t),this.apiMedia=this.options_.source.apiMedia,this.apiSession=this.options_.source.apiSession,this.receiver=this.apiSession.receiver.friendlyName;var o=this.onMediaStatusUpdate.bind(this),n=this.onSessionUpdate.bind(this);this.apiMedia.addUpdateListener(o),this.apiSession.addUpdateListener(n),this.on("dispose",function(){i.apiMedia.removeUpdateListener(o),i.apiSession.removeUpdateListener(n),i.onMediaStatusUpdate(),i.onSessionUpdate(!1)});var a,r,s,c=this.textTracks();c&&(a=i.handleTextTracksChange.bind(i),c.addEventListener("change",a),i.on("dispose",function(){c.removeEventListener("change",a)}),i.handleTextTracksChange());try{(c=this.audioTracks())&&(r=i.handleAudioTracksChange.bind(i),c.addEventListener("change",r),i.on("dispose",function(){c.removeEventListener("change",r)}))}catch(e){l.default.log("get player audioTracks fail"+e)}try{(c=this.videoTracks())&&(s=i.handleVideoTracksChange.bind(i),c.addEventListener("change",s),i.on("dispose",function(){c.removeEventListener("change",s)}))}catch(e){l.default.log("get player videoTracks fail"+e)}this.update(),this.triggerReady()}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n),i(u,[{key:"createEl",value:function(){return l.default.createEl("div",{id:this.options_.techId,className:"vjs-tech vjs-tech-chromecast"})}},{key:"update",value:function(){this.el_.innerHTML='<div class="casting-image" style="background-image: url(\''+this.options_.poster+'\')"></div><div class="casting-overlay"><div class="casting-information"><div class="casting-icon"></div><div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div></div></div>"}},{key:"onSessionUpdate",value:function(e){if(this.apiMedia)return e?void 0:this.onStopAppSuccess()}},{key:"onStopAppSuccess",value:function(){this.stopTrackingCurrentTime(),this.apiMedia=null}},{key:"onMediaStatusUpdate",value:function(){if(this.apiMedia)switch(this.apiMedia.playerState){case chrome.cast.media.PlayerState.BUFFERING:this.trigger("waiting");break;case chrome.cast.media.PlayerState.IDLE:this.trigger("timeupdate"),this.trigger("ended");break;case chrome.cast.media.PlayerState.PAUSED:this.trigger("pause"),this.paused_=!0;break;case chrome.cast.media.PlayerState.PLAYING:this.trigger("playing"),this.trigger("play"),this.paused_=!1}}},{key:"src",value:function(e){}},{key:"currentSrc",value:function(){if(this.apiMedia)return this.apiMedia.media.contentId}},{key:"handleAudioTracksChange",value:function(){var e=[],t=this.textTracks(),i=this.audioTracks();if(i){for(var o=0;o<i.length;o++)i[o].enabled&&e.push(o+1+t.length);return this.apiMedia&&e.length?(this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(e),this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this))):void 0}}},{key:"handleVideoTracksChange",value:function(){}},{key:"handleTextTracksChange",value:function(){var e=[],t=this.textTracks();if(t){for(var i=0;i<t.length;i++)"showing"===t[i].mode&&e.push(i+1);return this.apiMedia&&e.length?(this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(e),this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this))):void 0}}},{key:"onTrackSuccess",value:function(){return l.default.log("track added")}},{key:"onTrackError",value:function(e){return l.default.log("Cast track Error: "+JSON.stringify(e))}},{key:"castError",value:function(e){return l.default.log("Cast Error: "+JSON.stringify(e))}},{key:"play",value:function(){if(this.apiMedia)return this.paused_&&this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.castError.bind(this)),this.paused_=!1}},{key:"pause",value:function(){if(this.apiMedia)return this.paused_?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.castError.bind(this)),this.paused_=!0)}},{key:"paused",value:function(){return this.paused_}},{key:"ended",value:function(){return"FINISHED"===chrome.cast.media.IdleReason}},{key:"currentTime",value:function(){return this.apiMedia?this.apiMedia.getEstimatedTime():0}},{key:"setCurrentTime",value:function(e){if(!this.apiMedia)return 0;var t=void 0;return(t=new chrome.cast.media.SeekRequest).currentTime=e,this.apiMedia.seek(t,this.onSeekSuccess.bind(this,e),this.castError.bind(this))}},{key:"onSeekSuccess",value:function(e){l.default.log("seek success"+e)}},{key:"volume",value:function(){return this.volume_}},{key:"duration",value:function(){return this.apiMedia?this.apiMedia.media.duration||1/0:0}},{key:"controls",value:function(){return!1}},{key:"setVolume",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],i=void 0,o=void 0;if(this.apiMedia)return(o=new chrome.cast.Volume).level=e,o.muted=t,this.volume_=o.level,this.muted_=t,(i=new chrome.cast.media.VolumeRequest).volume=o,this.apiMedia.setVolume(i,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.castError.bind(this)),this.trigger("volumechange")}},{key:"mediaCommandSuccessCallback",value:function(e){l.default.log(e)}},{key:"muted",value:function(){return this.muted_}},{key:"setMuted",value:function(e){return this.setVolume(this.volume_,e)}},{key:"supportsFullScreen",value:function(){return!1}},{key:"resetSrc_",value:function(e){e()}},{key:"dispose",value:function(){this.resetSrc_(Function.prototype),d(Object.getPrototypeOf(u.prototype),"dispose",this).call(this,this)}}]),u}();a.prototype.paused_=!1,a.prototype.options_={},a.prototype.timerStep=1e3,a.isSupported=function(){return!0},n.withSourceHandlers(a),a.nativeSourceHandler={},a.nativeSourceHandler.canPlayType=function(e){return/^application\/(?:dash\+xml|(x-|vnd\.apple\.)mpegurl)/i.test(e)?"probably":/^video\/(mpd|mp4|webm|m3u8)/i.test(e)?"maybe":""},a.nativeSourceHandler.canHandleSource=function(e){return e.type?a.nativeSourceHandler.canPlayType(e.type):e.src?a.nativeSourceHandler.canPlayType(e.src):""},a.nativeSourceHandler.handleSource=function(e,t){t.src(e.src)},a.nativeSourceHandler.dispose=function(){},a.registerSourceHandler(a.nativeSourceHandler),a.prototype.featuresVolumeControl=!0,a.prototype.featuresPlaybackRate=!1,a.prototype.movingMediaElementInDOM=!1,a.prototype.featuresFullscreenResize=!1,a.prototype.featuresTimeupdateEvents=!1,a.prototype.featuresProgressEvents=!1,a.prototype.featuresNativeTextTracks=!0,a.prototype.featuresNativeAudioTracks=!0,a.prototype.featuresNativeVideoTracks=!1,l.default.options.chromecast={},n.registerTech("Chromecast",a),s.default=a,r.exports=s.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,r,s){(function(e){function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(s,"__esModule",{value:!0});var i=t("undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null),o=(t((t(a("./component/control-bar/chromecast-button")),a("./tech/chromecast"))),i.default.getComponent("Component")),n=function(e){function i(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),function(e,t,i){for(var o=!0;o;){var n=e,a=t,r=i;o=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(n);if(null===u)return;e=u,t=a,i=r,o=!0,s=u=void 0}}(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,e,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,o),i}();n.prototype.options_={},i.default.options.children.push("chromecast"),i.default.addLanguage("en",{"CASTING TO":"WIEDERGABE AUF"}),i.default.addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),i.default.addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),i.default.addLanguage("fr",{"CASTING TO":"CAST EN COURS SUR"}),o.registerComponent("Chromecast",n),s.default=n,r.exports=s.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./component/control-bar/chromecast-button":1,"./tech/chromecast":2}],4:[function(n,a,r){(function(e){function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=t("undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null),o=(t(n("./videojs-chromecast")),function(e){this.addChild("Chromecast",e)});(i.default.registerPlugin||i.default.plugin)("chromecast",o),r.default=o,a.exports=r.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./videojs-chromecast":3}]},{},[4])(4)});