"use strict";!function(){function a(e,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](e):e instanceof r}var s="fpContribShakaVideo",t=function(){function i(e,r,n){var c=this;this.vjs=videojs(n.playerId),this.videoEl=r.el(),this.errorHandler=function(e){1!==e.severity&&c.vjs.error(i.packageError(e))};var t=videojs.mergeOptions({},n.shaka,{drm:e.drm});this.shaka=new shaka.Player(this.videoEl),this.shaka.configure(t),this.shaka.setTextTrackVisibility(!1),this.shaka.addEventListener("error",this.errorHandler),this.signChunkUrl=a(e.drm,Object)&&a(e.drm.servers,Object)&&e.drm.servers["com.floatplane.signdash"]||void 0,"string"==typeof this.signChunkUrl&&(this.signChunkHandler=function(e,r){if(e===shaka.net.NetworkingEngine.RequestType.SEGMENT)return Promise.all(r.uris.map(function(s){return new Promise(function(e,r){var n=s.substr(c.shaka.getAssetUri().lastIndexOf("/")+1).split("/"),t=n[0],i=n[1],o=n[2];if("string"!=typeof t||"string"!=typeof i||"string"!=typeof o)return r("Failed to sign chunk.");var a=new XMLHttpRequest;a.addEventListener("load",function(){return 200===a.status?e(JSON.parse(a.responseText).url):r("Failed to sign chunk.")}),a.addEventListener("error",function(e){return r(e)}),a.open("GET",c.signChunkUrl+"?guid="+t+"&quality="+i+"&chunk="+o),a.send()})})).then(function(e){r.uris=e}).catch(function(e){throw c.vjs.error({code:6,message:"Playback failed. Unable to retrieve access token.",source:e}),e})},this.shaka.getNetworkingEngine().registerRequestFilter(this.signChunkHandler));i.doWrapped(this.videoEl,function(){return c.shaka.load(e.src).then(function(){r.triggerReady()}).catch(function(e){c.vjs.error(i.packageError(e))})})}return i.prototype.dispose=function(){var r=this;i.doWrapped(this.videoEl,function(){var e=r.shaka;return delete r.shaka,a(e,Object)?(r.signChunkHandler&&(e.getNetworkingEngine().unregisterRequestFilter(r.signChunkHandler),delete r.signChunkHandler),e.removeEventListener("error",r.errorHandler),e.destroy()):Promise.reject("The player has already been destroyed.")})},i.doWrapped=function(r,e){if(!(a(r,Object)&&"readyState"in r))throw new Error("A valid video element is required.");if(!a(e,Function))throw new Error("A valid function is required.");var n,t=a(r[s],Object)?r[s]:{},i=a(t.promChain,Object)&&a(t.promChain.then,Function)?t.promChain.then(function(){return e()},function(){return e()}):e();if(!a(i,Object)||!a(i.then,Function))throw new Error("Received an invalid value from the given handler function. A promise-like, thenable object is expected.");var o=function(){var e=r[s];e.promChain===n&&delete e.promChain};return n=t.promChain=i.then(o,o),r[s]=t,n},i.packageError=function(e){return{code:e.code,message:"Playback failed. "+({1:"A network error occurred.",2:"Text streams could not be parsed.",3:"Media streams could not be handled.",4:"Manifest could not be parsed.",5:"The media could not be streamed.",6:"A DRM error occurred.",7:"A player error occurred.",8:"Encountered an error when casting.",9:"A storage error occurred."}[e.category]||"An unknown error occurred."),source:e}},i}(),e=function(){function e(){}return e.canHandleSource=function(e){if("string"!=typeof e.src||!e.src.length)return"";var r=this.canPlayType(e.type);if(r)return r;try{return"mpd"===/.([a-z0-9]*)$/.exec(new URL(e.src).pathname.toLowerCase())[1]?"maybe":""}catch(e){}return""},e.handleSource=function(e,r,n){return new t(e,r,n)},e.canPlayType=function(e){return"string"!=typeof e?"":"application/dash+xml"===e.trim().toLowerCase()?"probably":""},e}();shaka.polyfill.installAll(),shaka.Player.isBrowserSupported()?videojs.getTech("Html5").registerSourceHandler(e,0):console.log("Not loading Shaka source handler: browser is not supported.")}();